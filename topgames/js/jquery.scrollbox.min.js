(function($){$.fn.scrollbox=function(config){var defConfig={linear:!1,startDelay:2,delay:3,step:5,speed:32,switchItems:1,direction:"vertical",distance:"auto",autoPlay:!0,onMouseOverPause:!0,paused:!1,queue:null,listElement:"ul",listItemElement:"li",infiniteLoop:!0,switchAmount:0,afterForward:null,afterBackward:null,triggerStackable:!1};return config=$.extend(defConfig,config),config.scrollOffset=config.direction==="vertical"?"scrollTop":"scrollLeft",config.queue&&(config.queue=$("#"+config.queue)),this.each(function(){var container=$(this),containerUL,scrollingId=null,nextScrollId=null,paused=!1,releaseStack,backward,forward,resetClock,scrollForward,scrollBackward,forwardHover,pauseHover,switchCount=0,stackedTriggerIndex=0;config.onMouseOverPause&&(container.bind("mouseover",function(){paused=!0}),container.bind("mouseout",function(){paused=!1})),containerUL=container.children(config.listElement+":first-child"),config.infiniteLoop===!1&&config.switchAmount===0&&(config.switchAmount=containerUL.children().length),scrollForward=function(){if(!paused){var curLi,i,newScrollOffset,scrollDistance,theStep;if(curLi=containerUL.children(config.listItemElement+":first-child"),scrollDistance=config.distance!=="auto"?config.distance:config.direction==="vertical"?curLi.outerHeight(!0):curLi.outerWidth(!0),config.linear?newScrollOffset=Math.min(container[0][config.scrollOffset]+config.step,scrollDistance):(theStep=Math.max(3,parseInt((scrollDistance-container[0][config.scrollOffset])*.3,10)),newScrollOffset=Math.min(container[0][config.scrollOffset]+theStep,scrollDistance)),container[0][config.scrollOffset]=newScrollOffset,newScrollOffset>=scrollDistance){for(i=0;i<config.switchItems;i++)config.queue&&config.queue.find(config.listItemElement).length>0?(containerUL.append(config.queue.find(config.listItemElement)[0]),containerUL.children(config.listItemElement+":first-child").remove()):containerUL.append(containerUL.children(config.listItemElement+":first-child")),++switchCount;if(container[0][config.scrollOffset]=0,clearInterval(scrollingId),scrollingId=null,$.isFunction(config.afterForward)&&config.afterForward.call(container,{switchCount:switchCount,currentFirstChild:containerUL.children(config.listItemElement+":first-child")}),config.triggerStackable&&stackedTriggerIndex!==0){releaseStack();return}if(config.infiniteLoop===!1&&switchCount>=config.switchAmount)return;config.autoPlay&&(nextScrollId=setTimeout(forward,config.delay*1e3))}}},scrollBackward=function(){if(!paused){var curLi,i,newScrollOffset,scrollDistance,theStep;if(container[0][config.scrollOffset]===0){for(i=0;i<config.switchItems;i++)containerUL.children(config.listItemElement+":last-child").insertBefore(containerUL.children(config.listItemElement+":first-child"));curLi=containerUL.children(config.listItemElement+":first-child"),scrollDistance=config.distance!=="auto"?config.distance:config.direction==="vertical"?curLi.height():curLi.width(),container[0][config.scrollOffset]=scrollDistance}if(config.linear?newScrollOffset=Math.max(container[0][config.scrollOffset]-config.step,0):(theStep=Math.max(3,parseInt(container[0][config.scrollOffset]*.3,10)),newScrollOffset=Math.max(container[0][config.scrollOffset]-theStep,0)),container[0][config.scrollOffset]=newScrollOffset,newScrollOffset===0){if(--switchCount,clearInterval(scrollingId),scrollingId=null,$.isFunction(config.afterBackward)&&config.afterBackward.call(container,{switchCount:switchCount,currentFirstChild:containerUL.children(config.listItemElement+":first-child")}),config.triggerStackable&&stackedTriggerIndex!==0){releaseStack();return}config.autoPlay&&(nextScrollId=setTimeout(forward,config.delay*1e3))}}},releaseStack=function(){stackedTriggerIndex!==0&&(stackedTriggerIndex>0?(stackedTriggerIndex--,nextScrollId=setTimeout(forward,0)):(stackedTriggerIndex++,nextScrollId=setTimeout(backward,0)))},forward=function(){clearInterval(scrollingId),scrollingId=setInterval(scrollForward,config.speed)},backward=function(){clearInterval(scrollingId),scrollingId=setInterval(scrollBackward,config.speed)},forwardHover=function(){config.autoPlay=!0,paused=!1,clearInterval(scrollingId),scrollingId=setInterval(scrollForward,config.speed)},pauseHover=function(){paused=!0},resetClock=function(delay){config.delay=delay||config.delay,clearTimeout(nextScrollId),config.autoPlay&&(nextScrollId=setTimeout(forward,config.delay*1e3))},config.autoPlay&&(nextScrollId=setTimeout(forward,config.startDelay*1e3)),container.bind("resetClock",function(delay){resetClock(delay)}),container.bind("forward",function(){config.triggerStackable?scrollingId!==null?stackedTriggerIndex++:forward():(clearTimeout(nextScrollId),forward())}),container.bind("backward",function(){config.triggerStackable?scrollingId!==null?stackedTriggerIndex--:backward():(clearTimeout(nextScrollId),backward())}),container.bind("pauseHover",function(){pauseHover()}),container.bind("forwardHover",function(){forwardHover()}),container.bind("speedUp",function(speed){speed==="undefined"&&(speed=Math.max(1,parseInt(config.speed/2,10))),config.speed=speed}),container.bind("speedDown",function(speed){speed==="undefined"&&(speed=config.speed*2),config.speed=speed}),container.bind("updateConfig",function(options){config=$.extend(config,options)})})}})(jQuery)