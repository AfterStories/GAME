(function(G){var B,J,C,K,N,M,I,E,H,A,L,F,D;if(B=document.namespaces,J=!!document.createElement("canvas").getContext,!(J||B)){G.fn.maphilight=function(){return this};return}J?(E=function(O){return Math.max(0,Math.min(parseInt(O,16),255))},H=function(O,P){return"rgba("+E(O.substr(0,2))+","+E(O.substr(2,2))+","+E(O.substr(4,2))+","+P+")"},C=function(O){var P=G('<canvas style="width:'+O.width+"px;height:"+O.height+'px;"><\/canvas>').get(0);return P.getContext("2d").clearRect(0,0,P.width,P.height),P},F=function(Q,O,R,P,S){if(P=P||0,S=S||0,Q.beginPath(),O=="rect")Q.rect(R[0]+P,R[1]+S,R[2]-R[0],R[3]-R[1]);else if(O=="poly")for(Q.moveTo(R[0]+P,R[1]+S),i=2;i<R.length;i+=2)Q.lineTo(R[i]+P,R[i+1]+S);else O=="circ"&&Q.arc(R[0]+P,R[1]+S,R[2],0,Math.PI*2,!1);Q.closePath()},K=function(Q,T,U,X,O){var S,P=Q.getContext("2d"),R,W,V;X.shadow&&(P.save(),X.shadowPosition=="inside"&&(F(P,T,U),P.clip()),R=Q.width*100,W=Q.height*100,F(P,T,U,R,W),P.shadowOffsetX=X.shadowX-R,P.shadowOffsetY=X.shadowY-W,P.shadowBlur=X.shadowRadius,P.shadowColor=H(X.shadowColor,X.shadowOpacity),V=X.shadowFrom,V||(V=X.shadowPosition=="outside"?"fill":"stroke"),V=="stroke"?(P.strokeStyle="rgba(0,0,0,1)",P.stroke()):V=="fill"&&(P.fillStyle="rgba(0,0,0,1)",P.fill()),P.restore(),X.shadowPosition=="outside"&&(P.save(),F(P,T,U),P.globalCompositeOperation="destination-out",P.fillStyle="rgba(0,0,0,1);",P.fill(),P.restore())),P.save(),F(P,T,U),X.fill&&(P.fillStyle=H(X.fillColor,X.fillOpacity),P.fill()),X.stroke&&(P.strokeStyle=H(X.strokeColor,X.strokeOpacity),P.lineWidth=X.strokeWidth,P.stroke()),P.restore(),X.fade&&G(Q).css("opacity",0).animate({opacity:1},100)},N=function(O){O.getContext("2d").clearRect(0,0,O.width,O.height)}):(C=function(O){return G('<var style="zoom:1;overflow:hidden;display:block;width:'+O.width+"px;height:"+O.height+'px;"><\/var>').get(0)},K=function(P,S,T,W,O){var U,V,Q,R;U='<v:fill color="#'+W.fillColor+'" opacity="'+(W.fill?W.fillOpacity:0)+'" />',V=W.stroke?'strokeweight="'+W.strokeWidth+'" stroked="t" strokecolor="#'+W.strokeColor+'"':'stroked="f"',Q='<v:stroke opacity="'+W.strokeOpacity+'"/>',S=="rect"?R=G('<v:rect name="'+O+'" filled="t" '+V+' style="zoom:1;margin:0;padding:0;display:block;position:absolute;left:'+T[0]+"px;top:"+T[1]+"px;width:"+(T[2]-T[0])+"px;height:"+(T[3]-T[1])+'px;"><\/v:rect>'):S=="poly"?R=G('<v:shape name="'+O+'" filled="t" '+V+' coordorigin="0,0" coordsize="'+P.width+","+P.height+'" path="m '+T[0]+","+T[1]+" l "+T.join(",")+' x e" style="zoom:1;margin:0;padding:0;display:block;position:absolute;top:0px;left:0px;width:'+P.width+"px;height:"+P.height+'px;"><\/v:shape>'):S=="circ"&&(R=G('<v:oval name="'+O+'" filled="t" '+V+' style="zoom:1;margin:0;padding:0;display:block;position:absolute;left:'+(T[0]-T[2])+"px;top:"+(T[1]-T[2])+"px;width:"+T[2]*2+"px;height:"+T[2]*2+'px;"><\/v:oval>')),R.get(0).innerHTML=U+Q,G(P).append(R)},N=function(O){G(O).find("[name=highlighted]").remove()}),M=function(P){for(var Q=P.getAttribute("coords").split(","),O=0;O<Q.length;O++)Q[O]=parseFloat(Q[O]);return[P.getAttribute("shape").toLowerCase().substr(0,4),Q]},L=function(Q,P){var O=G(Q);return G.extend({},P,G.metadata?O.metadata():!1,O.data("maphilight"))},A=function(O){return O.complete?typeof O.naturalWidth!="undefined"&&O.naturalWidth==0?!1:!0:!1},I={position:"absolute",left:0,top:0,padding:0,border:0},D=!1,G.fn.maphilight=function(Q){if(Q=G.extend({},G.fn.maphilight.defaults,Q),!J&&G.browser.msie&&!D){document.namespaces.add("v","urn:schemas-microsoft-com:vml");var P=document.createStyleSheet(),O=["shape","rect","oval","circ","fill","stroke","imagedata","group","textbox"];G.each(O,function(){P.addRule("v\\:"+this,"behavior: url(#default#VML); antialias:true")}),D=!0}return this.each(function(){var W,T,a,S,V,X,Z,U,Y,R;if(W=G(this),!A(this))return window.setTimeout(function(){W.maphilight(Q)},200);(a=G.extend({},Q,G.metadata?W.metadata():!1,W.data("maphilight")),Y=W.get(0).getAttribute("usemap"),S=G('map[name="'+Y.substr(1)+'"]'),W.is("img")&&Y&&S.size()>0)&&(W.hasClass("maphilighted")&&(R=W.parent(),W.insertBefore(R),R.remove(),G(S).unbind(".maphilight").find("area[coords]").unbind(".maphilight")),T=G("<div><\/div>").css({display:"block",background:'url("'+this.src+'")',position:"relative",padding:0,width:this.width,height:this.height}),a.wrapClass&&(a.wrapClass===!0?T.addClass(G(this).attr("class")):T.addClass(a.wrapClass)),W.before(T).css("opacity",0).css(I).remove(),G.browser.msie&&W.css("filter","Alpha(opacity=0)"),T.append(W),V=C(this),G(V).css(I),V.height=this.height,V.width=this.width,Z=function(f){var c,d,b,g;d=L(this,a),d.neverOn||d.alwaysOn||(c=M(this),K(V,c[0],c[1],d,"highlighted"),d.groupBy&&(b=/^[a-zA-Z][-a-zA-Z]+$/.test(d.groupBy)?S.find("area["+d.groupBy+'="'+G(this).attr(d.groupBy)+'"]'):S.find(d.groupBy),g=this,b.each(function(){var h,e;this!=g&&(h=L(this,a),h.neverOn||h.alwaysOn||(e=M(this),K(V,e[0],e[1],h,"highlighted")))})),J||G(V).append("<v:rect><\/v:rect>"))},G(S).bind("alwaysOn.maphilight",function(){X&&N(X),J||G(V).empty(),G(S).find("area[coords]").each(function(){var b,c;c=L(this,a),c.alwaysOn&&(!X&&J&&(X=C(W.get()),G(X).css(I),X.width=W.width(),X.height=W.height(),W.before(X)),c.fade=c.alwaysOnFade,b=M(this),J?K(X,b[0],b[1],c,""):K(V,b[0],b[1],c,""))})}),G(S).trigger("alwaysOn.maphilight").find("area[coords]").bind("mouseover.maphilight",Z).bind("mouseout.maphilight",function(b){N(V)}),W.before(V),W.addClass("maphilighted"))})},G.fn.maphilight.defaults={fill:!0,fillColor:"000000",fillOpacity:.2,stroke:!0,strokeColor:"ff0000",strokeOpacity:1,strokeWidth:1,fade:!0,alwaysOn:!1,neverOn:!1,groupBy:!1,wrapClass:!0,shadow:!1,shadowX:0,shadowY:0,shadowRadius:6,shadowColor:"000000",shadowOpacity:.8,shadowPosition:"outside",shadowFrom:!1}})(jQuery)