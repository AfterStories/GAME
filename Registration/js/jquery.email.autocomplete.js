(function($){$.fn.autoEmail=function(domains,multi){return this.each(function(){var $this=$(this),len,domain=domains[0];$this.keypress(function(e){var keyCode=e.keyCode?e.keyCode:e.which?e.which:e.charCode,protectedKeyCodes=[8,9,17,18,35,36,37,38,39,40,45,97,99,118],selStart,selEnd,separator,emailsDirty,last_LetterString,emailDomain,matches,subStr;if(!(protectedKeyCodes.indexOf(keyCode)>=0)){if(e.preventDefault(),selStart=$(this)[0].selectionStart,selEnd=$(this)[0].selectionEnd,len=$(this).val().length,/^(13|44|59)$/.test(""+keyCode)){multi&&(selStart!=selEnd?separator=keyCode==59?"; ":", ":keyCode!=13&&(separator=String.fromCharCode(keyCode)),separator!=null&&$this.val($this.val().substr(0,selEnd)+separator+$this.val().substr(selEnd,$this.val().length))),$this[0].selectionStart=selEnd+($this.val().length-len),$this[0].selectionEnd=selEnd+($this.val().length-len);return}($this.val($this.val().substr(0,selStart)+String.fromCharCode(keyCode)+$this.val().substr(selEnd,$this.val().length)),len=$(this).val().length-len,$this[0].selectionStart=++selStart,$this[0].selectionEnd=selEnd+len,emailsDirty=$(this).val().substr(0,selStart).split("@"),last_LetterString=$(this).val().slice(-1),emailsDirty.length<2||emailsDirty[0]==""||last_LetterString=="@")||(emailDomain=emailsDirty[emailsDirty.length-1],matches=$.grep(domains,function(el,index){return emailDomain===el.substr(0,emailDomain.length)}),matches.length>0&&(subStr=matches[0].substr(emailDomain.length,matches[0].length),$this.val($this.val().substr(0,selStart)+subStr+$this.val().substr(selStart,$this.val().length)),$this[0].selectionStart=selStart,$this[0].selectionEnd=selStart+subStr.length))}})})}})(jQuery)